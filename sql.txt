create database if not exists annotate;
use annotate;
CREATE DATABASE IF NOT EXISTS annotate; USE annotate;
CREATE TABLE IF NOT EXISTS image (id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT, filename VARCHAR(200) UNIQUE, width INT UNSIGNED, height INT UNSIGNED, deleted INT UNSIGNED DEFAULT 0, offtopic INT UNSIGNED DEFAULT 0, perception_hash VARCHAR(50) DEFAULT NULL, unidentifiable INT DEFAULT 0, INDEX idx_image (id, filename, width, height, perception_hash, deleted), INDEX idx_image_deleted_offtopic_perception_hash_id (deleted, offtopic, perception_hash, id), INDEX image_filename (filename)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
CREATE TABLE IF NOT EXISTS category (id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT, name VARCHAR(200) UNIQUE, INDEX idx_category (id, name)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
CREATE TABLE IF NOT EXISTS user (id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT, name VARCHAR(200) UNIQUE) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
CREATE TABLE IF NOT EXISTS annotation (id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT, image_id INT UNSIGNED, user_id INT UNSIGNED, category_id INT UNSIGNED, x_start INT UNSIGNED, y_start INT UNSIGNED, w INT UNSIGNED, h INT UNSIGNED, json VARCHAR(5000), annotarius_id VARCHAR(200) UNIQUE, modified TIMESTAMP DEFAULT CURRENT_TIMESTAMP, deleted INT UNSIGNED DEFAULT 0, curated INT UNSIGNED DEFAULT NULL, FOREIGN KEY (category_id) REFERENCES category(id) ON DELETE CASCADE, FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE, FOREIGN KEY (image_id) REFERENCES image(id) ON DELETE CASCADE, INDEX idx_annotation (image_id, category_id, deleted, x_start, y_start, w, h, id, modified), INDEX annotation_image_id (image_id)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
CREATE TABLE IF NOT EXISTS image_data (id INT UNSIGNED NOT NULL AUTO_INCREMENT, filename VARCHAR(255) NOT NULL UNIQUE, image_content LONGBLOB, PRIMARY KEY (id)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
CREATE TABLE IF NOT EXISTS models (id INT AUTO_INCREMENT PRIMARY KEY, model_name VARCHAR(100) NOT NULL, upload_time TIMESTAMP, filename VARCHAR(100), file_contents LONGBLOB, uuid VARCHAR(100) NOT NULL, UNIQUE KEY unique_models_uid (filename, uuid)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
CREATE TABLE IF NOT EXISTS model_labels (id INT UNSIGNED NOT NULL AUTO_INCREMENT, model_id INT NOT NULL, label_index INT UNSIGNED NOT NULL, label_name VARCHAR(255) NOT NULL, PRIMARY KEY (id), UNIQUE KEY unique_model_label (model_id, label_index), FOREIGN KEY (model_id) REFERENCES models(id) ON DELETE CASCADE) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
