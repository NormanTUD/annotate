create database if not exists annotate;
use annotate;
create table if not exists image (id int unsigned primary key auto_increment, filename varchar(200) unique, width int unsigned, height int unsigned, deleted int unsigned default 0, offtopic int unsigned default 0, perception_hash varchar(50) default null, unidentifiable int default 0, index idx_image (id, filename, width, height, perception_hash, deleted), index idx_image_deleted_offtopic_perception_hash_id (deleted, offtopic, perception_hash, id), index image_filename (filename));
create table if not exists category (id int unsigned primary key auto_increment, name varchar(200) unique, index idx_category (id, name));
create table if not exists user (id int unsigned primary key auto_increment, name varchar(200) unique);
create table if not exists annotation (id int unsigned primary key auto_increment, image_id int unsigned, user_id int unsigned, category_id int unsigned, x_start int unsigned, y_start int unsigned, w int unsigned, h int unsigned, json varchar(5000), annotarius_id varchar(200) unique, modified timestamp default current_timestamp, deleted int unsigned default 0, curated int unsigned default null, foreign key (category_id) references category(id) on delete cascade, foreign key (user_id) references user(id) on delete cascade, foreign key (image_id) references image(id) on delete cascade, index idx_annotation (image_id, category_id, deleted, x_start, y_start, w, h, id, modified), index annotation_image_id (image_id));
create table if not exists image_data (id int unsigned not null auto_increment, filename varchar(255) not null unique, image_content longblob, primary key (id));
create table if not exists models (id int auto_increment primary key, model_name varchar(100) not null, upload_time timestamp, filename varchar(100), file_contents longblob, uid varchar(100));
create table if not exists model_labels (id int unsigned not null auto_increment, uid varchar(100) not null, label_index int unsigned not null, label_name varchar(255) not null, primary key (id), unique key unique_model_label (uid, label_index), unique key unique_uid_label_name (uid, label_name), foreign key (uid) references models(uid) on delete cascade);
